{% extends 'base_2col.html' %}

{% block css %}
<link href="/static/bootstrap-datepicker/css/datepicker.css" rel="stylesheet" />
<link href="/static/bootstrap-fileupload/css/bootstrap-fileupload.min.css" rel="stylesheet" />
<link href="/static/lightbox/css/lightbox.css" rel="stylesheet" />
{% endblock %}

{% block js %}
<script src="/static/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script src="/static/highcharts/js/highcharts.js"></script>
<script src="/static/lightbox/js/lightbox.js"></script>
<script src="/static/js/history.manager.js"></script>
<script src="/static/js/manager.js"></script>
<script src="/static/js/formatter.js"></script>
<script src="/static/js/date.manager.js"></script>
<script src="/static/js/palette.manager.js"></script>
<script src="/static/js/users.manager.js"></script>
<script src="/static/js/expenses.ui.js"></script>
<script src="/static/js/expenses.manager.js"></script>
<script src="/static/js/categories.ui.js"></script>
<script src="/static/js/categories.manager.js"></script>
{% endblock %}

{% block jsready %}
PaletteManager.onReady(Logger, function() {
    DateManager.onReady($('#current_month'), {{ year }}, {{ month }});
    HistoryManager.onReady(DateManager);
    UsersManager.onReady(Logger);
    ExpensesUI.onReady(
            Formatter, PaletteManager, $('#current_month_overall'),
            $('#expenses'));
    ExpensesManager.onReady(Logger, DateManager, ExpensesUI);
    CategoriesUI.onReady(Formatter, PaletteManager, $('#categories'));
    CategoriesManager.onReady(Logger, DateManager, CategoriesUI);
    Manager.onReady(Logger, DateManager, 30000);

    Manager.update(function() {
        ExpensesManager.onUpdate();
        CategoriesManager.onUpdate();
    });
    Manager.monthChange(function(year, month) {
        DateManager.onMonthChange(year, month);
        HistoryManager.onMonthChange(year, month);
        ExpensesManager.onMonthChange(year, month);
        CategoriesManager.onMonthChange(year, month);
    });

    ExpensesManager.addSubmit(function() {
        CategoriesManager.onUpdate();
    })
    ExpensesUI.addExpense(function(exp) {
        ExpensesManager.onAddExpense(exp);
    })
    Manager.onUpdate(0);
});
{% endblock %}

{% block pre_row1 %}
<div class="span12">
    <h2 class="center"><span id="current_month"></span></h2>
    <div class="center"><span id="current_month_overall"></span></div>
    <ul class="nav nav-pills">
        <li class="pull-left"><a id="prev_month" href="#">&laquo; Previous Month</a>
        <li class="pull-right"><a id="next_month" href="#">Next Month &raquo;</a>
    </ul>
</div>
{% endblock %}

{% block row1_col1 %}
    <h3 class="center">By Date</h3>
    <div id="expenses">
        <div class="alert alert-info" style="display: none">
            All the tracked expenses for the current month will be listed here,
            one above the other, sorted by date.
        </div>
        <div id="expenses-inner"></div>
    </div>
{% endblock %}

{% block row1_col2 %}
    <h3 class="center">Summary</h3>
    <div id="categories">
        <div class="alert alert-info" style="display: none">
            Want to know how much did you spent in the current month for each
            expense category?  You are looking in the right place!  See the
            chart populating as as soon as you track expenses...
        </div>
        <div id="categories-chart" style="min-width: 300px; height: 300px; margin: 0 auto"></div>
    </div>
{% endblock %}
